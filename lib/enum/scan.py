import nmap
import subprocess

def nmapScan(hostToScan, project):
	print "[i] Running Nmap Scan"
	nm = nmap.PortScanner()
	nmapscan = nm.scan(hosts=hostToScan, arguments='-sC -sV -O -oN tests/'+project+'/output/nmap/standardScan')
	for host in nm.all_hosts():
		print('----------------------------------------------------')
		print('Host : %s (%s)' % (host, nm[host].hostname()))
		print('State : %s' % nm[host].state())
		for proto in nm[host].all_protocols():
			print('----------')
			print('Protocol : %s' % proto)

			lport = nm[host][proto].keys()
			lport.sort()
			for port in lport:
				print('port : %s\tstate : %s' % (port, nm[host][proto][port]['state']))
				lport = nm[host][proto].keys()
				lport.sort()
				for port in lport:
					print('port : %s\tstate : %s' % (port, nm[host][proto][port]['state']))
					if(port==80 and nm[host][proto][port]['state']=="open"):
						print "Website found"
						terminal = ['gnome-terminal']
						terminal.extend(['--tab', '-e', '''
						    bash -c '
    						    dirb http://hostToScan
					       	    exec bash
						    '
						''' % locals()])
						subprocess.call(terminal)

					if(port==443 and nm[host][proto][port]['state']=="open"):
                                                print "Website found with HTTPS"
